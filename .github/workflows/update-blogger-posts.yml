name: DEBUG Blogger API
on: workflow_dispatch

jobs:
  debug-blogger:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Debug API call
      run: |
        echo "🐛 DEBUG: Verificando qué está pasando..."
        echo "Blog ID: $BLOG_ID"
        echo "API Key starts with: ${API_KEY:0:10}..."
        
        # Hacer la petición con verbose
        URL="https://www.googleapis.com/blogger/v3/blogs/$BLOG_ID/posts?key=$API_KEY&maxResults=3"
        echo "URL: ${URL:0:100}..."
        
        curl -v "$URL" > debug.log 2>&1
        curl -s "$URL" > response.json
        
        echo "=== CÓDIGO HTTP ==="
        grep "HTTP/" debug.log || echo "No HTTP code found"
        
        echo "=== RESPONSE JSON ==="
        cat response.json
        
        echo "=== ¿TIENE ITEMS? ==="
        jq 'has("items")' response.json
        
        echo "=== NÚMERO DE ITEMS ==="
        jq '.items | length' response.json
        
        echo "=== PRIMER ITEM ==="
        jq '.items[0] | {title: .title, url: .url}' response.json
        
      env:
        API_KEY: ${{ secrets.BLOGGER_API_KEY }}
        BLOG_ID: ${{ vars.BLOGGER_BLOG_ID }}
